<!--DOCTYPE html>
<html-- xmlns:th="http://www.thymeleaf.org">
<head>
    <title>G√©n√©ration d'attestion These</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body>
<div class="container mt-5">
    <h2>G√©n√©ration d'attestion These</h2>
    <p th:text="|La th√®se intitul√©e '${these.titre}' a √©t√© r√©dig√©e par ${these.etudiant.nom},
        encadr√©e par ${these.encadrant.nom}, dans l'UFR ${these.ecoleDoctorat.ufr.nom} durant l'ann√©e ${these.annee}.|">
    </p>

    <a href="/memoires/doctorats" class="btn btn-primary">Retour</a>
</div>
</body>
</html-->


<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Attestation de d√©p√¥t de th√®se</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        @page { size: A4; margin: 0; }
        body {
            font-family: "Times New Roman", Times, serif;
            margin: 0;
            padding: 30px;
            background: white;
            color: black;
            line-height: 1.7;
        }
        .container {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            border: 5px double #5B2C6F; /* violet fonc√© comme sur ton mod√®le */
            padding: 40px 50px;
            position: relative;
            background: white;
            box-sizing: border-box;
        }
        .header { text-align: center; margin-bottom: 30px; }
        .logo { width: 90px; height: auto; margin-bottom: 10px; }
        .university { font-size: 22px; font-weight: bold; color: #333; }
        .year { position: absolute; top: 30px; right: 60px; font-size: 13px; }
        .section-title { font-weight: bold; margin: 8px 0; font-size: 16px; }
        .title-box {
            text-align: center;
            font-size: 26px;
            font-weight: bold;
            padding: 18px;
            margin: 40px 0;
            background: linear-gradient(to bottom, #ddd, #bbb);
            border-radius: 20px;
            box-shadow: inset 0 4px 8px rgba(0,0,0,0.3);
            color: #333;
        }
        .dotted { border-top: 2px dotted black; margin: 40px 0; }
        .justify { text-align: justify; }
        .bold { font-weight: bold; }

        .actions {
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 1000;
        }
        .actions button {
            margin-left: 12px;
            padding: 10px 20px;
            font-size: 14px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        .print-btn { background: #28a745; color: white; }
        .pdf-btn   { background: #c82333; color: white; }
        .back-btn  { background: #6c757d; color: white; }

        @media print {
            .actions { display: none !important; }
            body { padding: 15px; }
        }
    </style>

    <!-- jsPDF + html2canvas pour export PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>

<div class="container">

    <!-- En-t√™te -->
    <div class="header">
        <img th:src="@{/img/logo1.png}" alt="Logo UASZ" class="logo" onerror="this.style.display='none'">
        <div class="university">UNIVERSIT√â ASSANE SECK DE ZIGUINCHOR</div>
        <div class="section-title">RECTORAT</div>
        <div class="section-title">BIBLIOTH√àQUE CENTRALE</div>
        <div>BP: 523 ‚Äì Ziguinchor / T√©l: 33 991 88 40</div>
    </div>

    <div class="year" th:text="'Ann√©e universitaire : ' + ${these.annee}"></div>

    <!-- Titre principal -->
    <div class="title-box">
        ATTESTATION DE D√âP√îT<br/>DE TH√àSE
    </div>

    <div class="dotted"></div>

    <!-- Corps du texte -->
    <p class="justify">
        Je soussign√©,  <strong th:text="${directeur}"></strong>, Directeur de la Biblioth√®que Centrale de l‚ÄôUniversit√© Assane Seck de Ziguinchor,
        atteste que
        <span class="bold" th:text="${these.etudiant.nom}"></span>,
        doctorant(e) √† l‚ÄôUFR <span th:text="${these.ecoleDoctorat.ufr.nom}"></span>,
        a d√©pos√© sa th√®se en version papier et num√©rique √† la Biblioth√®que centrale.
    </p>

    <p class="justify" style="margin-top: 30px;">
        <span class="bold">Sujet :</span>
        <em th:text="${these.titre}"></em>
    </p>
    <p class="justify" style="margin-top: 60px;">
        En foi de quoi, la pr√©sente attestation lui est d√©livr√©e pour servir et valoir ce que de droit.
    </p>

    <!-- Date et lieu -->
    <div style="margin-top: 80px;">
        Ziguinchor, le <span th:text="${#temporals.format(#temporals.createNow(), 'dd MMMM yyyy')}"></span>
    </div>

    <!-- Signature -->
    <div style="margin-top: 100px; text-align: left;">
        <div style="width: 350px; border-top: 1px solid black; padding-top: 10px;">
            <strong>Le Directeur de la Biblioth√®que Centrale</strong><br/>
            <strong th:text="${directeur}"></strong>
        </div>
    </div>

</div>

<!-- Boutons d'action -->
<div class="actions">
    <button class="print-btn" onclick="window.print()">üñ®Ô∏è Imprimer</button>
    <button class="pdf-btn" id="downloadPdf">üìÑ PDF</button>
    <button class="back-btn" onclick="window.location.href='/memoires/doctorats'">‚Üê Retour</button>
</div>

<script>
    document.getElementById('downloadPdf').addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');

        html2canvas(document.querySelector('.container'), {
            scale: 2.5,
            useCORS: true,
            backgroundColor: '#ffffff'
        }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const imgWidth = 210;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;

            doc.addImage(imgData, 'PNG', 0, 0, imgWidth, imgHeight);
            const nom = "[[${these.etudiant.nom}]]".replace(/ /g, "_");
            doc.save("Attestation_These_" + nom + ".pdf");
        });
    });
</script>

</body>
</html>