<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Attestation de d√©p√¥t de m√©moire</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Police classique pour les attestations officielles -->
    <style>
        @page { size: A4; margin: 0; }
        body {
            font-family: "Times New Roman", Times, serif;
            margin: 0;
            padding: 40px;
            background: white;
            color: black;
            line-height: 1.6;
        }
        .container {
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            border: 4px double black;
            padding: 40px 50px;
            position: relative;
            background: white;
            box-sizing: border-box;
        }
        .header { text-align: center; margin-bottom: 30px; }
        .logo { width: 90px; height: auto; margin-bottom: 10px; }
        .university { font-size: 20px; font-weight: bold; margin: 8px 0; }
        .year { position: absolute; top: 25px; right: 60px; font-size: 13px; }
        .section-title { font-weight: bold; margin: 8px 0; }
        .title-box {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            padding: 18px;
            margin: 40px 0;
            border: 3px solid black;
            border-radius: 15px;
            background-color: #f9f9f9;
        }
        .dotted { border-top: 2px dotted black; margin: 35px 0; }
        .justify { text-align: justify; }
        .bold { font-weight: bold; }

        /* Boutons en bas - discrets mais fonctionnels */
        .actions {
            position: fixed;
            bottom: 20px;
            right: 30px;
            z-index: 1000;
        }
        .actions button {
            margin-left: 10px;
            padding: 10px 18px;
            font-size: 14px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .print-btn   { background: #28a745; color: white; }
        .pdf-btn     { background: #dc3545; color: white; }
        .back-btn    { background: #6c757d; color: white; }

        @media print {
            .actions { display: none !important; }
            body { padding: 20px; }
        }
    </style>

    <!-- jsPDF pour exporter en vrai PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>

<div class="container">

    <!-- En-t√™te -->
    <div class="header">
        <img th:src="@{/img/logo1.png}" alt="Logo UASZ" class="logo" onerror="this.style.display='none'">
        <div class="university">UNIVERSIT√â ASSANE SECK DE ZIGUINCHOR</div>
        <div class="section-title">RECTORAT</div>
        <div class="section-title">BIBLIOTH√àQUE CENTRALE</div>
        <div>BP: 523 ‚Äì Ziguinchor / T√©l: 33 991 88 40</div>
    </div>

    <div class="year" th:text="'Ann√©e universitaire : ' + ${memoire.annee}"></div>

    <div class="title-box">
        ATTESTATION DE D√âP√îT DE<br/>M√âMOIRE DE MASTER
    </div>

    <div class="dotted"></div>

    <p class="justify">
        Je soussign√©, <strong th:text="${directeur}"></strong>, Directeur de la Biblioth√®que Centrale de l‚ÄôUniversit√© Assane Seck de Ziguinchor,
        atteste que <span class="bold" th:text="${memoire.etudiant.nom}"></span>,
        √©tudiant(e) en Master <span th:text="${memoire.filiere.nom}"></span>,
        a d√©pos√© son m√©moire de master en version papier et num√©rique √† la Biblioth√®que centrale.
    </p>

    <p class="justify">
        <span class="bold">Sp√©cialit√© :</span> <span th:text="${memoire.filiere.nom}"></span><br/>
        <span class="bold">Sujet :</span> <span th:text="${memoire.titre}"></span>
    </p>

    <p class="justify" style="margin-top: 50px;">
        En foi de quoi, la pr√©sente attestation lui est d√©livr√©e pour servir et valoir ce que de droit.
    </p>

    <div class="date-place" style="margin-top: 60px;">
        Ziguinchor, le <span th:text="${#temporals.format(#temporals.createNow(), 'dd MMMM yyyy')}"></span>
    </div>

    <div style="margin-top: 100px; text-align: left;">
        <div style="width: 320px; border-top: 1px solid black; padding-top: 10px;">
            <strong>Le Directeur de la Biblioth√®que Centrale</strong><br/>
            <strong th:text="${directeur}"></strong>
        </div>
    </div>
</div>

<!-- Boutons d'action -->
<div class="actions">
    <button class="print-btn" onclick="window.print()">üñ®Ô∏è Imprimer</button>
    <button class="pdf-btn" id="downloadPdf">üìÑ PDF</button>
    <button class="back-btn" onclick="window.location.href='/master'">‚Üê Retour</button>
</div>

<script>
    document.getElementById('downloadPdf').addEventListener('click', function () {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');

        html2canvas(document.querySelector('.container'), {
            scale: 2,
            useCORS: true,
            backgroundColor: '#ffffff'
        }).then(canvas => {
            const imgData = canvas.toDataURL('image/png');
            const imgWidth = 210;
            const pageHeight = 297;
            const imgHeight = (canvas.height * imgWidth) / canvas.width;
            let heightLeft = imgHeight;

            let position = 0;
            doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;

            while (heightLeft >= 0) {
                position = heightLeft - imgHeight;
                doc.addPage();
                doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
            }

            const nomEtudiant = "[[${memoire.etudiant.nom}]]".replace(/ /g, "_");
            doc.save("Attestation_Depot_" + nomEtudiant + ".pdf");
        });
    });
</script>

</body>
</html>